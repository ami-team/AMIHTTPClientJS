/*!
 * AMI HTTP Client 1.0.0
 *
 * Copyright © 2021-2022 CNRS/LPSC
 *
 * Author: Jérôme ODIER (jerome.odier@lpsc.in2p3.fr)
 *
 * Repositories: https://gitlab.in2p3.fr/ami-team/AMIHTTPClientJS/
 *               https://www.github.com/ami-team/AMIHTTPClientJS/
 *
 * This software is a computer program whose purpose is to provide an
 * HTTP Client to the ATLAS Metadata Interface (AMI) ecosystem.
 *
 * This software is governed by the CeCILL-C license under French law and
 * abiding by the rules of distribution of free software. You can use,
 * modify and/or redistribute the software under the terms of the CeCILL-C
 * license as circulated by CEA, CNRS and INRIA at the following URL
 * "http://www.cecill.info".
 *
 * The fact that you are presently reading this means that you have had
 * knowledge of the CeCILL-C license and that you accept its terms.
 *
 */(()=>{var e={915:(e,t,n)=>{e.exports=n(583)},583:(e,t,n)=>{"use strict";var r;!function(){var o=1,a=2,u=3,i=4,s=5,c=6,f=7,l=8,p=9,h=10,y=11,v=function(){var e,t,n,r,v=1,g=2,d=3,w=4,m=5,b=6,x=7,I='Unexpected token "%0"',j="Unexpected end of path";function O(){for(var e,t=A();U("|");)G(),(e||(e=[t])).push(A());return e?{type:l,args:e}:t}function A(){return U("(")?k():P()}function k(){L("(");var e=O();L(")");for(var t,n=[];t=S();)n.push(t);return n.length?e.type===o?(e.parts=e.parts.concat(n),e):(n.unshift(e),{type:o,parts:n}):e}function S(){return U("[")?function(){L("[");var e=function(){if(U(":"))return G(),{type:h,toIdx:N()};var e=N();if(U(":"))return G(),U("]")?{type:h,fromIdx:e}:{type:h,fromIdx:e,toIdx:N()};return{type:h,idx:e}}();return L("]"),{type:i,arg:e}}():U("{")?function(){L("{");var e=M();return L("}"),{type:u,arg:e}}():U("(")?k():void 0}function P(){_()||Z(G());var e,t=!1;U("^")?(G(),t=!0):D()&&(e=G().val.substr(1));for(var n,r=[];n=W()?function(){var e,t=G().val,n=z();(U("*")||n.type===v||n.type===d)&&(e=G().val);return{type:a,selector:t,prop:e}}():S();)r.push(n);return{type:o,fromRoot:t,subst:e,parts:r}}function M(){for(var e,t=$();U("||");)G(),(e||(e=[t])).push($());return e?{type:s,op:"||",args:e}:t}function $(){for(var e,t=C();U("&&");)G(),(e||(e=[t])).push(C());return e?{type:s,op:"&&",args:e}:t}function C(){for(var e=T();U("==")||U("!=")||U("===")||U("!==")||U("^==")||U("==^")||U("^=")||U("=^")||U("$==")||U("==$")||U("$=")||U("=$")||U("*==")||U("==*")||U("*=")||U("=*");)e={type:c,op:G().val,args:[e,C()]};return e}function T(){for(var e=function(){var e=E();for(;U("+")||U("-");)e={type:f,op:G().val,args:[e,E()]};return e}();U("<")||U(">")||U("<=")||U(">=");)e={type:c,op:G().val,args:[e,T()]};return e}function E(){for(var e=N();U("*")||U("/")||U("%");)e={type:f,op:G().val,args:[e,E()]};return e}function N(){return U("!")||U("-")?{type:p,op:G().val,arg:N()}:function(){var e=z().type;if(e===d||e===g||e===w||e===m)return{type:y,val:G().val};if(_())return P();if(U("("))return function(){L("(");var e=M();return L(")"),e}();return Z(G())}()}function U(e){var t=z();return t.type===b&&t.val===e}function _(){return W()||D()||U("^")}function W(){var e=z();if(e.type===b){var t=e.val;return"."===t||".."===t}return!1}function D(){var e=z();return e.type===v&&"$"===e.val[0]}function L(e){var t=G();t.type===b&&t.val===e||Z(t)}function z(){if(null!==n)return n;var e=t;return n=B(),t=e,n}function B(){for(;n=e[t]," \r\n\t".indexOf(n)>-1;)++t;var n;if(t>=r)return{type:x,range:[t,t]};var o=function(){var n=t,r=e[t],o=e[t+1];if("."===r){if(R(o))return;return"."===e[++t]?{type:b,val:"..",range:[n,++t]}:{type:b,val:".",range:[n,t]}}if("="===o){var a=e[t+2];if("="===a){if("=!^$*".indexOf(r)>=0)return{type:b,val:r+o+a,range:[n,t+=3]}}else if("^$*".indexOf(a)>=0){if("="===r)return{type:b,val:r+o+a,range:[n,t+=3]}}else if("=!^$*><".indexOf(r)>=0)return{type:b,val:r+o,range:[n,t+=2]}}else if("="===r&&"^$*".indexOf(o)>=0)return{type:b,val:r+o,range:[n,t+=2]};if(r===o&&("|"===r||"&"===r))return{type:b,val:r+o,range:[n,t+=2]};if(":{}()[]^+-*/%!><|".indexOf(r)>=0)return{type:b,val:r,range:[n,++t]}}();if(o||(o=function(){var n=e[t];if(!F(n))return;var o=t,a=n;for(;++t<r&&J(n=e[t]);)a+=n;switch(a){case"true":case"false":return{type:w,val:"true"===a,range:[o,t]};case"null":return{type:m,val:null,range:[o,t]};default:return{type:v,val:a,range:[o,t]}}}())||(o=function(){if('"'!==e[t]&&"'"!==e[t])return;var n,o=e[t],a=++t,u="",i=!1;for(;t<r;){if("\\"===(n=e[t++]))n=e[t++];else if(('"'===n||"'"===n)&&n===o){i=!0;break}u+=n}if(i)return{type:d,val:u,range:[a,t]}}())||(o=function(){var n=t,o=e[t],a="."===o;if(a||R(o)){for(var u=o;++t<r;){if("."===(o=e[t])){if(a)return;a=!0}else if(!R(o))break;u+=o}return{type:g,val:a?parseFloat(u):parseInt(u,10),range:[n,t]}}}()))return o;o={range:[t,t]},t>=r?o.type=x:o.val=e[t],Z(o)}function G(){var e;return n?(t=n.range[1],e=n,n=null,e):B()}function R(e){return"0123456789".indexOf(e)>=0}function F(e){return"$"===e||"@"===e||"_"===e||e>="a"&&e<="z"||e>="A"&&e<="Z"}function J(e){return F(e)||e>="0"&&e<="9"}function Z(e){e.type===x&&X(e,j),X(e,I,e.val)}function X(e,t){var n=Array.prototype.slice.call(arguments,2),r=t.replace(/%(\d)/g,(function(e,t){return n[t]||""})),o=new Error(r);throw o.column=e.range[0],o}return function(o){e=o.split(""),t=0,n=null,r=e.length;var a=O(),u=G();return u.type!==x&&Z(u),a}}(),g=function(){var e,t,n,r;function h(){if(r.length)return r.shift();var e="v"+ ++n;return t.push(e),e}function v(){for(var e=arguments,t=e.length;t--;)r.push(e[t])}function g(t,n,r){if(t.prop){var o=j(t.prop),a=h(),u=h(),i=h(),s=h(),c=h(),f=h(),l=h();e.push(a,"= [];",u,"= 0;",i,"=",r,".length;",l,"= [];","while(",u,"<",i,") {",s,"=",r,"[",u,"++];","if(",s,"!= null) {"),"*"===t.prop?(e.push("if(typeof ",s,'=== "object") {',"if(isArr(",s,")) {",a,"=",a,".concat(",s,");","}","else {","for(",c," in ",s,") {","if(",s,".hasOwnProperty(",c,")) {",f,"=",s,"[",c,"];"),O(a,f),e.push("}","}","}","}")):(e.push(f,"=",s,"[",o,"];"),O(a,f,l,i)),e.push("}","}",n,"=",i,"> 1 &&",l,".length?",l,".length > 1?","concat.apply(",a,",",l,") :",a,".concat(",l,"[0]) :",a,";"),v(a,u,i,s,c,f,l)}}function d(t,n,r){var o=t.prop,a=h(),u=h(),i=h(),s=h(),c=h(),f=h(),l=h(),p=h();e.push(a,"=",r,".slice(),",p,"= [];","while(",a,".length) {",u,"=",a,".shift();"),o?e.push("if(typeof ",u,'=== "object" &&',u,") {"):e.push("if(typeof ",u,"!= null) {"),e.push(i,"= [];","if(isArr(",u,")) {",s,"= 0,",l,"=",u,".length;","while(",s,"<",l,") {",f,"=",u,"[",s,"++];"),o&&e.push("if(typeof ",f,'=== "object") {'),O(i,f),o&&e.push("}"),e.push("}","}","else {"),o?"*"!==o&&(e.push(f,"=",u,'["'+o+'"];'),O(p,f)):(O(p,u),e.push("if(typeof ",u,'=== "object") {')),e.push("for(",c," in ",u,") {","if(",u,".hasOwnProperty(",c,")) {",f,"=",u,"[",c,"];"),O(i,f),"*"===o&&O(p,f),e.push("}","}"),o||e.push("}"),e.push("}",i,".length &&",a,".unshift.apply(",a,",",i,");","}","}",n,"=",p,";"),v(a,u,i,s,c,f,l,p)}function w(t,n,r){var o=h(),a=h(),u=h(),i=h(),s=h();e.push(o,"= [];",a,"= 0;",u,"=",r,".length;","while(",a,"<",u,") {",s,"=",r,"[",a,"++];"),b(t.arg,i,s),e.push(k(t.arg,i),"&&",o,".push(",s,");","}",n,"=",o,";"),v(o,a,u,s,i)}function m(t,n,r){var o,a,u=t.arg;if(u.idx){var i=h();return b(u.idx,i,r),e.push(i,"< 0 && (",i,"=",r,".length +",i,");",n,"=",r,"[",i,"] == null? [] : [",r,"[",i,"]];"),v(i),!1}u.fromIdx?u.toIdx?(b(u.fromIdx,o=h(),r),b(u.toIdx,a=h(),r),e.push(n,"=",r,".slice(",o,",",a,");"),v(o,a)):(b(u.fromIdx,o=h(),r),e.push(n,"=",r,".slice(",o,");"),v(o)):(b(u.toIdx,a=h(),r),e.push(n,"=",r,".slice(0,",a,");"),v(a))}function b(t,n,r){switch(t.type){case o:!function(t,n,r){var o=t.parts,s=0,c=o.length;for(e.push(n,"=",t.fromRoot?"data":t.subst?"subst."+t.subst:r,";","isArr("+n+") || ("+n+" = ["+n+"]);");s<c;){var f=o[s++];switch(f.type){case a:".."===f.selector?d(f,n,n):g(f,n,n);break;case u:w(f,n,n);break;case i:m(f,n,n);break;case l:I(f,n,n)}}}(t,n,r);break;case l:I(t,n,r);break;case c:!function(t,n,r){var a=h(),u=h(),i=h(),s=h(),c=h(),f=h(),l=h(),p=h(),g=t.args[0],d=t.args[1];e.push(n,"= false;"),b(g,a,r),b(d,u,r);var w=g.type===o,m=d.type===y;e.push(i,"="),w?e.push("true;"):e.push("isArr(",a,");"),e.push(s,"="),m?e.push("false;"):e.push("isArr(",u,");"),e.push("if("),w||e.push(i,"&&"),e.push(a,".length === 1) {",a,"=",a,"[0];",i,"= false;","}"),m||e.push("if(",s,"&&",u,".length === 1) {",u,"=",u,"[0];",s,"= false;","}"),e.push(c,"= 0;","if(",i,") {",l,"=",a,".length;"),m||(e.push("if(",s,") {",p,"=",u,".length;","while(",c,"<",l,"&& !",n,") {",f,"= 0;","while(",f,"<",p,") {"),x(t.op,[a,"[",c,"]"].join(""),[u,"[",f,"]"].join("")),e.push(n,"= true;","break;","}","++",f,";","}","++",c,";","}","}","else {"));e.push("while(",c,"<",l,") {"),x(t.op,[a,"[",c,"]"].join(""),u),e.push(n,"= true;","break;","}","++",c,";","}"),m||e.push("}"),e.push("}"),m||(e.push("else if(",s,") {",p,"=",u,".length;","while(",c,"<",p,") {"),x(t.op,a,[u,"[",c,"]"].join("")),e.push(n,"= true;","break;","}","++",c,";","}","}"));e.push("else {",n,"=",N[t.op](a,u),";","}"),v(a,u,i,s,c,f,l,p)}(t,n,r);break;case f:!function(t,n,r){var o=h(),a=h(),u=t.args;b(u[0],o,r),b(u[1],a,r),e.push(n,"=",N[t.op](S(u[0],o),S(u[1],a)),";"),v(o,a)}(t,n,r);break;case s:!function(t,n,r){var o,a=[],u=t.args,i=u.length,s=0;switch(e.push(n,"= false;"),t.op){case"&&":for(;s<i;)a.push(o=h()),b(u[s],o,r),e.push("if(",k(u[s++],o),") {");e.push(n,"= true;");break;case"||":for(;s<i;)a.push(o=h()),b(u[s],o,r),e.push("if(",k(u[s],o),") {",n,"= true;","}"),1+s++<i&&e.push("else {");--i}for(;i--;)e.push("}");v.apply(null,a)}(t,n,r);break;case p:!function(t,n,r){var o=h(),a=t.arg;switch(b(a,o,r),t.op){case"!":e.push(n,"= !",k(a,o)+";");break;case"-":e.push(n,"= -",S(a,o)+";")}v(o)}(t,n,r);break;case y:e.push(n,"="),O=t.val,e.push("string"==typeof O?j(O):null===O?"null":O),e.push(";")}var O}function x(t,n,r){e.push("if(",N[t](n,r),") {")}function I(t,n,r){for(var o=[],a=t.args,u=a.length,i=0;i<u;)o.push(h()),b(a[i],o[i++],r);e.push(n,"= concat.call(",o.join(","),");"),v.apply(null,o)}function j(e){return"'"+e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"}function O(t,n,r,o){e.push("if(typeof ",n,'!== "undefined") {',"if(isArr(",n,")) {"),r&&(e.push(o,"> 1?"),A(r,n),e.push(":")),e.push(t,"=",t,".length?",t,".concat(",n,") :",n,".slice()",";","}","else {"),r&&e.push("if(",r,".length) {",t,"= concat.apply(",t,",",r,");",r,"= [];","}"),A(t,n),e.push(";","}","}")}function A(t,n){e.push(t,".length?",t,".push(",n,") :",t,"[0] =",n)}function k(e,t){switch(e.type){case s:return t;case y:return"!!"+t;case o:return t+".length > 0";default:return["(typeof ",t,'=== "boolean"?',t,":","isArr(",t,")?",t,".length > 0 : !!",t,")"].join("")}}function S(e,t){switch(e.type){case y:return t;case o:return t+"[0]";default:return["(isArr(",t,")?",t,"[0] : ",t,")"].join("")}}function P(e,t){return["typeof ",e,'=== "string" && typeof ',t,'=== "string" &&',e,".indexOf(",t,") === 0"].join("")}function M(e,t){return[e,"!= null &&",t,"!= null &&",e,".toString().toLowerCase().indexOf(",t,".toString().toLowerCase()) === 0"].join("")}function $(e,t){return["typeof ",e,'=== "string" && typeof ',t,'=== "string" &&',e,".length >=",t,".length &&",e,".lastIndexOf(",t,") ===",e,".length -",t,".length"].join("")}function C(e,t){return[e,"!= null &&",t,"!= null &&","(",e,"=",e,".toString()).length >=","(",t,"=",t,".toString()).length &&","(",e,".toLowerCase()).lastIndexOf(","(",t,".toLowerCase())) ===",e,".length -",t,".length"].join("")}function T(e,t){return["typeof ",e,'=== "string" && typeof ',t,'=== "string" &&',e,".indexOf(",t,") > -1"].join("")}function E(e,t){return[e,"!= null && ",t,"!= null &&",e,".toString().toLowerCase().indexOf(",t,".toString().toLowerCase()) > -1"].join("")}var N={"===":function(e,t){return e+"==="+t},"==":function(e,t){return["typeof ",e,'=== "string" && typeof ',t,'=== "string"?',e,".toLowerCase() ===",t,".toLowerCase() :"+e,"==",t].join("")},">=":function(e,t){return e+">="+t},">":function(e,t){return e+">"+t},"<=":function(e,t){return e+"<="+t},"<":function(e,t){return e+"<"+t},"!==":function(e,t){return e+"!=="+t},"!=":function(e,t){return e+"!="+t},"^==":P,"==^":function(e,t){return P(t,e)},"^=":M,"=^":function(e,t){return M(t,e)},"$==":$,"==$":function(e,t){return $(t,e)},"$=":C,"=$":function(e,t){return C(t,e)},"*==":T,"==*":function(e,t){return T(t,e)},"=*":function(e,t){return E(t,e)},"*=":E,"+":function(e,t){return e+"+"+t},"-":function(e,t){return e+"-"+t},"*":function(e,t){return e+"*"+t},"/":function(e,t){return e+"/"+t},"%":function(e,t){return e+"%"+t}};return function(a){if(e=[],t=["res"],n=0,r=[],b(a,"res","data"),e.unshift("var ",Array.isArray?"isArr = Array.isArray":'toStr = Object.prototype.toString, isArr = function(o) { return toStr.call(o) === "[object Array]"; }',", concat = Array.prototype.concat",",",t.join(","),";"),a.type===o){var u=a.parts[a.parts.length-1];u&&u.type===i&&"idx"in u.arg&&e.push("res = res[0];")}return e.push("return res;"),e.join("")}}();function d(e){return Function("data,subst",g(v(e)))}var w={},m=[],b={cacheSize:100},x={cacheSize:function(e,t){if(t<e&&m.length>t)for(var n=m.splice(0,m.length-t),r=n.length;r--;)delete w[n[r]]}},I=function(e,t,n){return w[e]||(w[e]=d(e),m.push(e)>b.cacheSize&&delete w[m.shift()]),w[e](t,n||{})};I.version="0.3.4",I.params=function(e){if(!arguments.length)return b;for(var t in e)e.hasOwnProperty(t)&&(x[t]&&x[t](b[t],e[t]),b[t]=e[t])},I.compile=d,I.apply=I,"object"==typeof e.exports?e.exports=I:"object"==typeof modules?modules.define("jspath",(function(e){e(I)})):(r=function(e,t,n){n.exports=I}.call(t,n,t,e),void 0===r||(e.exports=r))}()}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=n(915),t=n.n(e);function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,a=[],u=!0,i=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);u=!0);}catch(e){i=!0,o=e}finally{try{u||null==n.return||n.return()}finally{if(i)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){s(e,t),t.set(e,n)}function s(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function l(e,t,n){return function(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}(e,t),n}function p(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,y(e,t,"get"))}function h(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,y(e,t,"set"),n),n}function y(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var v=new WeakMap,g=new WeakMap,d=new WeakMap,w=new WeakMap,m=new WeakSet,b=function(){function e(t){var n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s(n=this,r=m),r.add(n),c(this,"version","1.0.0"),i(this,v,{writable:!0,value:""}),i(this,g,{writable:!0,value:"AMIXmlToJson.xsl"}),i(this,d,{writable:!0,value:new RegExp("-\\W*([a-zA-Z][a-zA-Z0-9]*)\\W*=\\W*\\?","g")}),i(this,w,{writable:!0,value:"resource temporarily unreachable"}),h(this,v,t)}var n,o,y;return n=e,o=[{key:"getEndpoint",value:function(){return p(this,v)}},{key:"execute",value:function(n,o){var u=this,i=((o=o||{}).endpoint||p(this,v)).trim(),s=(o.converter||p(this,g)).trim(),f=o.extras||{},h=o.params||[],y=o.timeout||12e4,m=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({Command:n=(n||"").trim().replace(p(this,d),(function(e,t){var n=h.shift();return"[object String]"===Object.prototype.toString.call(n)?"-".concat(t,"=").concat(JSON.stringify(n)):"-".concat(t,'="').concat(JSON.stringify(n),'"')})),Converter:s},f),b=Object.entries(m).map((function(e){var t=r(e,2),n=t[0],o=t[1];return"".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(o))})).join("&"),I=i,j=i+"?"+b;return new Promise((function(n,r){if("AMIXmlToJson.xsl"===s){var o=!0,a=setTimeout((function(){r(l(e,e,x).call(e,"timeout","timeout",j,!0)),o=!1}),y);fetch(I,{body:b,method:"POST",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},credentials:"include",cache:"no-cache",mode:"cors"}).finally((function(){clearTimeout(a)})).then((function(a){o&&a.json().then((function(o){var a=t().apply(".AMIMessage.info.$",o),u=t().apply(".AMIMessage.error.$",o);0===u.length?n(l(e,e,x).call(e,o,a.join(". "),j,!1)):r(l(e,e,x).call(e,o,u.join(". "),j,!0))})).catch((function(){r(l(e,e,x).call(e,p(u,w),p(u,w),j,!0))}))})).catch((function(){o&&r(l(e,e,x).call(e,p(u,w),p(u,w),j,!0))}))}else{var i=!0,c=setTimeout((function(){r(l(e,e,x).call(e,"timeout","timeout",j,!1)),i=!1}),y);fetch(I,{body:b,method:"POST",headers:{Accept:"text/plain","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},credentials:"include",cache:"no-cache",mode:"cors"}).finally((function(){clearTimeout(c)})).then((function(t){i&&t.text().then((function(t){n(l(e,e,x).call(e,t,t,j,!1))})).catch((function(){r(l(e,e,x).call(e,p(u,w),p(u,w),j,!1))}))})).catch((function(){i&&r(l(e,e,x).call(e,p(u,w),p(u,w),j,!1))}))}}))}},{key:"signInByCode",value:function(e,t){return(t=t||{}).extras={NoCert:null},t.params=[e],f(this,m,j).call(this,this.execute('GetSessionInfo -AMIUser="__oidc_code__" -AMIPass=?',t))}},{key:"signInByToken",value:function(e,t){return(t=t||{}).extras={NoCert:null},t.params=[e],f(this,m,j).call(this,this.execute('GetSessionInfo -AMIUser="__oidc_token__" -AMIPass=?',t))}},{key:"signInByPassword",value:function(e,t,n){return(n=n||{}).extras={NoCert:null},n.params=[e,t],f(this,m,j).call(this,this.execute("GetSessionInfo -AMIUser=? -AMIPass=?",n))}},{key:"signInByCertificate",value:function(e){return(e=e||{}).extras={},e.params=[],f(this,m,j).call(this,this.execute("GetSessionInfo",e))}},{key:"signOut",value:function(e){return(e=e||{}).extras={NoCert:null},e.params=["",""],f(this,m,j).call(this,this.execute("GetSessionInfo -AMIUser=? -AMIPass=?",e))}},{key:"jspath",value:function(e,n){return t().apply(e,n)}}],o&&u(n.prototype,o),y&&u(n,y),Object.defineProperty(n,"prototype",{writable:!1}),e}();function x(e,t,n,r){return r&&(e={AMIMessage:[{error:[{$:e}]}]}),{data:e,message:t,urlWithParameters:n}}function I(){return{AMIUser:"guest",guestUser:"guest",clientDNInAMI:"",issuerDNInAMI:"",clientDNInSession:"",issuerDNInSession:"",notBefore:"",notAfter:"",mqttToken:"",firstName:"guest",lastName:"guest",email:"N/A",country:"N/A",valid:"false"}}function j(e){return new Promise((function(n,r){e.then((function(e){var r={},o={},a={},u={},i={};t().apply('..rowset{.@type==="user"}.row.field',e.data).forEach((function(e){r[e["@name"]]=e.$})),t().apply('..rowset{.@type==="awf"}.row.field',e.data).forEach((function(e){i[e["@name"]]=e.$})),t().apply('..rowset{.@type==="role"}.row',e.data).forEach((function(e){var t="",n={};e.field.forEach((function(e){n[e["@name"]]=e.$,"name"===e["@name"]&&(t=e.$)})),o[t]=n})),t().apply('..rowset{.@type==="bookmark"}.row',e.data).forEach((function(e){var t="",n={};e.field.forEach((function(e){n[e["@name"]]=e.$,"hash"===e["@name"]&&(t=e.$)})),a[t]=n})),t().apply('..rowset{.@type==="dashboard"}.row',e.data).forEach((function(e){var t="",n={};e.field.forEach((function(e){n[e["@name"]]=e.$,"hash"===e["@name"]&&(t=e.$)})),u[t]=n})),n({data:e.data,message:e.message,userInfo:r,roleInfo:o,bookmarkInfo:a,dashboardInfo:u,awfInfo:i})})).catch((function(e){r({data:e.data,message:e.message,userInfo:l(b,b,I).call(b),roleInfo:{},bookmarkInfo:{},dashboardInfo:{},awfInfo:{}})}))}))}"undefined"!=typeof window&&(window.AMIHTTPClient=b)})()})();