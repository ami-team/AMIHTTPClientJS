/*!
 * Copyright © 2021-2021 CNRS/LPSC
 *
 * Author: Jérôme ODIER (jerome.odier@lpsc.in2p3.fr)
 *
 * Repositories: https://gitlab.in2p3.fr/ami-team/AMIHTTPClientJS/
 *               https://www.github.com/ami-team/AMIHTTPClientJS/
 *
 * This software is a computer program whose purpose is to provide an
 * HTTP Client to the ATLAS Metadata Interface (AMI) ecosystem.
 *
 * This software is governed by the CeCILL-C license under French law and
 * abiding by the rules of distribution of free software. You can use,
 * modify and/or redistribute the software under the terms of the CeCILL-C
 * license as circulated by CEA, CNRS and INRIA at the following URL
 * "http://www.cecill.info".
 *
 * The fact that you are presently reading this means that you have had
 * knowledge of the CeCILL-C license and that you accept its terms.
 *
 */(()=>{var e={915:(e,r,t)=>{e.exports=t(583)},583:(e,r,t)=>{"use strict";var n;!function(){var o=1,u=2,a=3,i=4,s=5,p=6,f=7,c=8,l=9,h=10,y=11,v=function(){var e,r,t,n,v=1,g=2,d=3,w=4,b=5,x=6,m=7,j='Unexpected token "%0"',O="Unexpected end of path";function A(){for(var e,r=I();_("|");)G(),(e||(e=[r])).push(I());return e?{type:c,args:e}:r}function I(){return _("(")?$():P()}function $(){U("(");var e=A();U(")");for(var r,t=[];r=k();)t.push(r);return t.length?e.type===o?(e.parts=e.parts.concat(t),e):(t.unshift(e),{type:o,parts:t}):e}function k(){return _("[")?function(){U("[");var e=function(){if(_(":"))return G(),{type:h,toIdx:W()};var e=W();if(_(":"))return G(),_("]")?{type:h,fromIdx:e}:{type:h,fromIdx:e,toIdx:W()};return{type:h,idx:e}}();return U("]"),{type:i,arg:e}}():_("{")?function(){U("{");var e=S();return U("}"),{type:a,arg:e}}():_("(")?$():void 0}function P(){z()||N(G());var e,r=!1;_("^")?(G(),r=!0):D()&&(e=G().val.substr(1));for(var t,n=[];t=L()?function(){var e,r=G().val,t=R();(_("*")||t.type===v||t.type===d)&&(e=G().val);return{type:u,selector:r,prop:e}}():k();)n.push(t);return{type:o,fromRoot:r,subst:e,parts:n}}function S(){for(var e,r=C();_("||");)G(),(e||(e=[r])).push(C());return e?{type:s,op:"||",args:e}:r}function C(){for(var e,r=E();_("&&");)G(),(e||(e=[r])).push(E());return e?{type:s,op:"&&",args:e}:r}function E(){for(var e=M();_("==")||_("!=")||_("===")||_("!==")||_("^==")||_("==^")||_("^=")||_("=^")||_("$==")||_("==$")||_("$=")||_("=$")||_("*==")||_("==*")||_("*=")||_("=*");)e={type:p,op:G().val,args:[e,E()]};return e}function M(){for(var e=function(){var e=T();for(;_("+")||_("-");)e={type:f,op:G().val,args:[e,T()]};return e}();_("<")||_(">")||_("<=")||_(">=");)e={type:p,op:G().val,args:[e,M()]};return e}function T(){for(var e=W();_("*")||_("/")||_("%");)e={type:f,op:G().val,args:[e,T()]};return e}function W(){return _("!")||_("-")?{type:l,op:G().val,arg:W()}:function(){var e=R().type;if(e===d||e===g||e===w||e===b)return{type:y,val:G().val};if(z())return P();if(_("("))return function(){U("(");var e=S();return U(")"),e}();return N(G())}()}function _(e){var r=R();return r.type===x&&r.val===e}function z(){return L()||D()||_("^")}function L(){var e=R();if(e.type===x){var r=e.val;return"."===r||".."===r}return!1}function D(){var e=R();return e.type===v&&"$"===e.val[0]}function U(e){var r=G();r.type===x&&r.val===e||N(r)}function R(){if(null!==t)return t;var e=r;return t=F(),r=e,t}function F(){for(;t=e[r]," \r\n\t".indexOf(t)>-1;)++r;var t;if(r>=n)return{type:m,range:[r,r]};var o=function(){var t=r,n=e[r],o=e[r+1];if("."===n){if(Z(o))return;return"."===e[++r]?{type:x,val:"..",range:[t,++r]}:{type:x,val:".",range:[t,r]}}if("="===o){var u=e[r+2];if("="===u){if("=!^$*".indexOf(n)>=0)return{type:x,val:n+o+u,range:[t,r+=3]}}else if("^$*".indexOf(u)>=0){if("="===n)return{type:x,val:n+o+u,range:[t,r+=3]}}else if("=!^$*><".indexOf(n)>=0)return{type:x,val:n+o,range:[t,r+=2]}}else if("="===n&&"^$*".indexOf(o)>=0)return{type:x,val:n+o,range:[t,r+=2]};if(n===o&&("|"===n||"&"===n))return{type:x,val:n+o,range:[t,r+=2]};if(":{}()[]^+-*/%!><|".indexOf(n)>=0)return{type:x,val:n,range:[t,++r]}}();if(o||(o=function(){var t=e[r];if(!B(t))return;var o=r,u=t;for(;++r<n&&J(t=e[r]);)u+=t;switch(u){case"true":case"false":return{type:w,val:"true"===u,range:[o,r]};case"null":return{type:b,val:null,range:[o,r]};default:return{type:v,val:u,range:[o,r]}}}())||(o=function(){if('"'!==e[r]&&"'"!==e[r])return;var t,o=e[r],u=++r,a="",i=!1;for(;r<n;){if("\\"===(t=e[r++]))t=e[r++];else if(('"'===t||"'"===t)&&t===o){i=!0;break}a+=t}if(i)return{type:d,val:a,range:[u,r]}}())||(o=function(){var t=r,o=e[r],u="."===o;if(u||Z(o)){for(var a=o;++r<n;){if("."===(o=e[r])){if(u)return;u=!0}else if(!Z(o))break;a+=o}return{type:g,val:u?parseFloat(a):parseInt(a,10),range:[t,r]}}}()))return o;o={range:[r,r]},r>=n?o.type=m:o.val=e[r],N(o)}function G(){var e;return t?(r=t.range[1],e=t,t=null,e):F()}function Z(e){return"0123456789".indexOf(e)>=0}function B(e){return"$"===e||"@"===e||"_"===e||e>="a"&&e<="z"||e>="A"&&e<="Z"}function J(e){return B(e)||e>="0"&&e<="9"}function N(e){e.type===m&&X(e,O),X(e,j,e.val)}function X(e,r){var t=Array.prototype.slice.call(arguments,2),n=r.replace(/%(\d)/g,(function(e,r){return t[r]||""})),o=new Error(n);throw o.column=e.range[0],o}return function(o){e=o.split(""),r=0,t=null,n=e.length;var u=A(),a=G();return a.type!==m&&N(a),u}}(),g=function(){var e,r,t,n;function h(){if(n.length)return n.shift();var e="v"+ ++t;return r.push(e),e}function v(){for(var e=arguments,r=e.length;r--;)n.push(e[r])}function g(r,t,n){if(r.prop){var o=O(r.prop),u=h(),a=h(),i=h(),s=h(),p=h(),f=h(),c=h();e.push(u,"= [];",a,"= 0;",i,"=",n,".length;",c,"= [];","while(",a,"<",i,") {",s,"=",n,"[",a,"++];","if(",s,"!= null) {"),"*"===r.prop?(e.push("if(typeof ",s,'=== "object") {',"if(isArr(",s,")) {",u,"=",u,".concat(",s,");","}","else {","for(",p," in ",s,") {","if(",s,".hasOwnProperty(",p,")) {",f,"=",s,"[",p,"];"),A(u,f),e.push("}","}","}","}")):(e.push(f,"=",s,"[",o,"];"),A(u,f,c,i)),e.push("}","}",t,"=",i,"> 1 &&",c,".length?",c,".length > 1?","concat.apply(",u,",",c,") :",u,".concat(",c,"[0]) :",u,";"),v(u,a,i,s,p,f,c)}}function d(r,t,n){var o=r.prop,u=h(),a=h(),i=h(),s=h(),p=h(),f=h(),c=h(),l=h();e.push(u,"=",n,".slice(),",l,"= [];","while(",u,".length) {",a,"=",u,".shift();"),o?e.push("if(typeof ",a,'=== "object" &&',a,") {"):e.push("if(typeof ",a,"!= null) {"),e.push(i,"= [];","if(isArr(",a,")) {",s,"= 0,",c,"=",a,".length;","while(",s,"<",c,") {",f,"=",a,"[",s,"++];"),o&&e.push("if(typeof ",f,'=== "object") {'),A(i,f),o&&e.push("}"),e.push("}","}","else {"),o?"*"!==o&&(e.push(f,"=",a,'["'+o+'"];'),A(l,f)):(A(l,a),e.push("if(typeof ",a,'=== "object") {')),e.push("for(",p," in ",a,") {","if(",a,".hasOwnProperty(",p,")) {",f,"=",a,"[",p,"];"),A(i,f),"*"===o&&A(l,f),e.push("}","}"),o||e.push("}"),e.push("}",i,".length &&",u,".unshift.apply(",u,",",i,");","}","}",t,"=",l,";"),v(u,a,i,s,p,f,c,l)}function w(r,t,n){var o=h(),u=h(),a=h(),i=h(),s=h();e.push(o,"= [];",u,"= 0;",a,"=",n,".length;","while(",u,"<",a,") {",s,"=",n,"[",u,"++];"),x(r.arg,i,s),e.push($(r.arg,i),"&&",o,".push(",s,");","}",t,"=",o,";"),v(o,u,a,s,i)}function b(r,t,n){var o,u,a=r.arg;if(a.idx){var i=h();return x(a.idx,i,n),e.push(i,"< 0 && (",i,"=",n,".length +",i,");",t,"=",n,"[",i,"] == null? [] : [",n,"[",i,"]];"),v(i),!1}a.fromIdx?a.toIdx?(x(a.fromIdx,o=h(),n),x(a.toIdx,u=h(),n),e.push(t,"=",n,".slice(",o,",",u,");"),v(o,u)):(x(a.fromIdx,o=h(),n),e.push(t,"=",n,".slice(",o,");"),v(o)):(x(a.toIdx,u=h(),n),e.push(t,"=",n,".slice(0,",u,");"),v(u))}function x(r,t,n){switch(r.type){case o:!function(r,t,n){var o=r.parts,s=0,p=o.length;for(e.push(t,"=",r.fromRoot?"data":r.subst?"subst."+r.subst:n,";","isArr("+t+") || ("+t+" = ["+t+"]);");s<p;){var f=o[s++];switch(f.type){case u:".."===f.selector?d(f,t,t):g(f,t,t);break;case a:w(f,t,t);break;case i:b(f,t,t);break;case c:j(f,t,t)}}}(r,t,n);break;case c:j(r,t,n);break;case p:!function(r,t,n){var u=h(),a=h(),i=h(),s=h(),p=h(),f=h(),c=h(),l=h(),g=r.args[0],d=r.args[1];e.push(t,"= false;"),x(g,u,n),x(d,a,n);var w=g.type===o,b=d.type===y;e.push(i,"="),w?e.push("true;"):e.push("isArr(",u,");"),e.push(s,"="),b?e.push("false;"):e.push("isArr(",a,");"),e.push("if("),w||e.push(i,"&&"),e.push(u,".length === 1) {",u,"=",u,"[0];",i,"= false;","}"),b||e.push("if(",s,"&&",a,".length === 1) {",a,"=",a,"[0];",s,"= false;","}"),e.push(p,"= 0;","if(",i,") {",c,"=",u,".length;"),b||(e.push("if(",s,") {",l,"=",a,".length;","while(",p,"<",c,"&& !",t,") {",f,"= 0;","while(",f,"<",l,") {"),m(r.op,[u,"[",p,"]"].join(""),[a,"[",f,"]"].join("")),e.push(t,"= true;","break;","}","++",f,";","}","++",p,";","}","}","else {"));e.push("while(",p,"<",c,") {"),m(r.op,[u,"[",p,"]"].join(""),a),e.push(t,"= true;","break;","}","++",p,";","}"),b||e.push("}"),e.push("}"),b||(e.push("else if(",s,") {",l,"=",a,".length;","while(",p,"<",l,") {"),m(r.op,u,[a,"[",p,"]"].join("")),e.push(t,"= true;","break;","}","++",p,";","}","}"));e.push("else {",t,"=",W[r.op](u,a),";","}"),v(u,a,i,s,p,f,c,l)}(r,t,n);break;case f:!function(r,t,n){var o=h(),u=h(),a=r.args;x(a[0],o,n),x(a[1],u,n),e.push(t,"=",W[r.op](k(a[0],o),k(a[1],u)),";"),v(o,u)}(r,t,n);break;case s:!function(r,t,n){var o,u=[],a=r.args,i=a.length,s=0;switch(e.push(t,"= false;"),r.op){case"&&":for(;s<i;)u.push(o=h()),x(a[s],o,n),e.push("if(",$(a[s++],o),") {");e.push(t,"= true;");break;case"||":for(;s<i;)u.push(o=h()),x(a[s],o,n),e.push("if(",$(a[s],o),") {",t,"= true;","}"),1+s++<i&&e.push("else {");--i}for(;i--;)e.push("}");v.apply(null,u)}(r,t,n);break;case l:!function(r,t,n){var o=h(),u=r.arg;switch(x(u,o,n),r.op){case"!":e.push(t,"= !",$(u,o)+";");break;case"-":e.push(t,"= -",k(u,o)+";")}v(o)}(r,t,n);break;case y:e.push(t,"="),A=r.val,e.push("string"==typeof A?O(A):null===A?"null":A),e.push(";")}var A}function m(r,t,n){e.push("if(",W[r](t,n),") {")}function j(r,t,n){for(var o=[],u=r.args,a=u.length,i=0;i<a;)o.push(h()),x(u[i],o[i++],n);e.push(t,"= concat.call(",o.join(","),");"),v.apply(null,o)}function O(e){return"'"+e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"}function A(r,t,n,o){e.push("if(typeof ",t,'!== "undefined") {',"if(isArr(",t,")) {"),n&&(e.push(o,"> 1?"),I(n,t),e.push(":")),e.push(r,"=",r,".length?",r,".concat(",t,") :",t,".slice()",";","}","else {"),n&&e.push("if(",n,".length) {",r,"= concat.apply(",r,",",n,");",n,"= [];","}"),I(r,t),e.push(";","}","}")}function I(r,t){e.push(r,".length?",r,".push(",t,") :",r,"[0] =",t)}function $(e,r){switch(e.type){case s:return r;case y:return"!!"+r;case o:return r+".length > 0";default:return["(typeof ",r,'=== "boolean"?',r,":","isArr(",r,")?",r,".length > 0 : !!",r,")"].join("")}}function k(e,r){switch(e.type){case y:return r;case o:return r+"[0]";default:return["(isArr(",r,")?",r,"[0] : ",r,")"].join("")}}function P(e,r){return["typeof ",e,'=== "string" && typeof ',r,'=== "string" &&',e,".indexOf(",r,") === 0"].join("")}function S(e,r){return[e,"!= null &&",r,"!= null &&",e,".toString().toLowerCase().indexOf(",r,".toString().toLowerCase()) === 0"].join("")}function C(e,r){return["typeof ",e,'=== "string" && typeof ',r,'=== "string" &&',e,".length >=",r,".length &&",e,".lastIndexOf(",r,") ===",e,".length -",r,".length"].join("")}function E(e,r){return[e,"!= null &&",r,"!= null &&","(",e,"=",e,".toString()).length >=","(",r,"=",r,".toString()).length &&","(",e,".toLowerCase()).lastIndexOf(","(",r,".toLowerCase())) ===",e,".length -",r,".length"].join("")}function M(e,r){return["typeof ",e,'=== "string" && typeof ',r,'=== "string" &&',e,".indexOf(",r,") > -1"].join("")}function T(e,r){return[e,"!= null && ",r,"!= null &&",e,".toString().toLowerCase().indexOf(",r,".toString().toLowerCase()) > -1"].join("")}var W={"===":function(e,r){return e+"==="+r},"==":function(e,r){return["typeof ",e,'=== "string" && typeof ',r,'=== "string"?',e,".toLowerCase() ===",r,".toLowerCase() :"+e,"==",r].join("")},">=":function(e,r){return e+">="+r},">":function(e,r){return e+">"+r},"<=":function(e,r){return e+"<="+r},"<":function(e,r){return e+"<"+r},"!==":function(e,r){return e+"!=="+r},"!=":function(e,r){return e+"!="+r},"^==":P,"==^":function(e,r){return P(r,e)},"^=":S,"=^":function(e,r){return S(r,e)},"$==":C,"==$":function(e,r){return C(r,e)},"$=":E,"=$":function(e,r){return E(r,e)},"*==":M,"==*":function(e,r){return M(r,e)},"=*":function(e,r){return T(r,e)},"*=":T,"+":function(e,r){return e+"+"+r},"-":function(e,r){return e+"-"+r},"*":function(e,r){return e+"*"+r},"/":function(e,r){return e+"/"+r},"%":function(e,r){return e+"%"+r}};return function(u){if(e=[],r=["res"],t=0,n=[],x(u,"res","data"),e.unshift("var ",Array.isArray?"isArr = Array.isArray":'toStr = Object.prototype.toString, isArr = function(o) { return toStr.call(o) === "[object Array]"; }',", concat = Array.prototype.concat",",",r.join(","),";"),u.type===o){var a=u.parts[u.parts.length-1];a&&a.type===i&&"idx"in a.arg&&e.push("res = res[0];")}return e.push("return res;"),e.join("")}}();function d(e){return Function("data,subst",g(v(e)))}var w={},b=[],x={cacheSize:100},m={cacheSize:function(e,r){if(r<e&&b.length>r)for(var t=b.splice(0,b.length-r),n=t.length;n--;)delete w[t[n]]}},j=function(e,r,t){return w[e]||(w[e]=d(e),b.push(e)>x.cacheSize&&delete w[b.shift()]),w[e](r,t||{})};j.version="0.3.4",j.params=function(e){if(!arguments.length)return x;for(var r in e)e.hasOwnProperty(r)&&(m[r]&&m[r](x[r],e[r]),x[r]=e[r])},j.compile=d,j.apply=j,"object"==typeof e.exports?e.exports=j:"object"==typeof modules?modules.define("jspath",(function(e){e(j)})):(n=function(e,r,t){t.exports=j}.call(r,t,r,e),void 0===n||(e.exports=n))}()}},r={};function t(n){var o=r[n];if(void 0!==o)return o.exports;var u=r[n]={exports:{}};return e[n](u,u.exports,t),u.exports}t.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},t.d=(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},t.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),(()=>{"use strict";var e=t(915),r=t.n(e);function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(Object(t),!0).forEach((function(r){i(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function u(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,r){!function(e,r){if(r.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,r),r.add(e)}function i(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function s(e,r,t){if(!r.has(e))throw new TypeError("attempted to get private field on non-instance");return t}var p=new WeakSet,f=function(){function e(r){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),a(this,p),i(this,"_endpoint","http://xxyy.zz"),i(this,"_converter","AMIXmlToJson.xsl"),i(this,"_paramRegExp",new RegExp("-\\W*([a-zA-Z][a-zA-Z0-9]*)\\W*=\\W*\\?","g")),this.setEndpoint(r)}var t,n,f;return t=e,(n=[{key:"execute",value:function(e,t){t=t||{};var n=$.Deferred(),u=(t.endpoint||this._endpoint).trim(),a=(t.converter||this._converter).trim(),i=t.extras||{},s=t.params||[],p=t.context||n,f=t.timeout||12e4;e=(e||"").trim().replace(this._paramRegExp,(function(e,r){return"-".concat(r,'="').concat(String(s.shift()).replace("\\","\\\\").replace("\n","\\n").replace('"','\\"').replace("'","\\'"),'"')}));var c=o(o({},i),{},{Command:e,Converter:a}),l=u,h=u+"?"+$.param(c);return"AMIXmlToJson.xsl"===a?$.ajax({url:l,data:c,type:"POST",timeout:f,dataType:"json",xhrFields:{withCredentials:!0},success:function(e){var t=r().apply(".AMIMessage.info.$",e),o=r().apply(".AMIMessage.error.$",e);0===o.length?n.resolveWith(p,[e,t.join(". "),h]):n.rejectWith(p,[e,o.join(". "),h])},error:function(e,r){"error"===r&&(r="service temporarily unreachable"),"parsererror"===r&&(r="resource temporarily unreachable");var t={AMIMessage:[{error:[{$:r}]}]};n.rejectWith(p,[t,r,h])}}):$.ajax({url:l,data:c,type:"POST",timeout:f,dataType:"text",xhrFields:{withCredentials:!0},success:function(e){n.resolveWith(p,[e,e,h])},error:function(e,r){"error"===r&&(r="service temporarily unreachable"),n.rejectWith(p,[r,r,h])}}),n.promise()}},{key:"signInByPassword",value:function(e,r,t){return s(this,p,c).call(this,this.execute("GetSessionInfo -AMIUser=? -AMIPass=?",{extras:{NoCert:null},params:[e,r]}),t)}},{key:"signInByCertificate",value:function(e){return s(this,p,c).call(this,this.execute("GetSessionInfo",{extras:{},params:[]}),e)}},{key:"signOut",value:function(e){return s(this,p,c).call(this,this.execute("GetSessionInfo -AMIUser=? -AMIPass=?",{extras:{NoCert:null},params:["",""]}),e)}},{key:"setEndpoint",value:function(e){e&&(this._endpoint=e)}},{key:"jspath",value:function(e,t){return r().apply(e,t)}}])&&u(t.prototype,n),f&&u(t,f),e}();function c(e,t){t=t||{};var n=$.Deferred(),o=t.context||n;return e.then((function(e,t){var u={},a={},i={},s={},p={};r().apply('..rowset{.@type==="user"}.row.field',e).forEach((function(e){u[e["@name"]]=e.$})),r().apply('..rowset{.@type==="udp"}.row.field',e).forEach((function(e){s[e["@name"]]=e.$})),r().apply('..rowset{.@type==="sso"}.row.field',e).forEach((function(e){p[e["@name"]]=e.$})),r().apply('..rowset{.@type==="role"}.row',e).forEach((function(e){var r="",t={};e.field.forEach((function(e){t[e["@name"]]=e.$,"name"===e["@name"]&&(r=e.$)})),a[r]=t})),r().apply('..rowset{.@type==="bookmark"}.row',e).forEach((function(e){var r="",t={};e.field.forEach((function(e){t[e["@name"]]=e.$,"hash"===e["@name"]&&(r=e.$)})),i[r]=t})),n.resolveWith(o,[e,t,u,a,i,s,p])}),(function(e,r){n.rejectWith(o,[e,r,{AMIUser:"guest",guestUser:"guest"},{},{},{},{}])})),n.promise()}"undefined"!=typeof window&&(window.AMIHTTPClient=f)})()})();